# claude-sudo-tools

> On-demand sudo access for Claude Code CLI on Linux. Authenticates once via GUI dialog, caches credentials for 90 minutes.

## Quick Start
- Install: `git clone https://github.com/hugsband/claude-sudo-tools && cd claude-sudo-tools && ./scripts/install.sh`
- Run: `claude-sudo`
- Uninstall: `./scripts/uninstall.sh`

## Documentation Index

### Essential
- [README](./README.md): Installation, usage, requirements, quick troubleshooting
- [Troubleshooting](./docs/TROUBLESHOOTING.md): Common issues and solutions

### Technical
- [Architecture](./docs/ARCHITECTURE.md): Component diagram, data flow, script internals, extension points
- [Security](./docs/SECURITY.md): How credential caching works, threat model, recommendations

### Contributing
- [Contributing](./CONTRIBUTING.md): How to contribute, code style, PR process
- [Changelog](./CHANGELOG.md): Version history

## Key Components

| File | Purpose |
|------|---------|
| [bin/claude-sudo](./bin/claude-sudo) | Main wrapper - sets SUDO_ASKPASS, authenticates, spawns keepalive, exec claude |
| [bin/claude-askpass](./bin/claude-askpass) | GUI password prompt - tries kdialog, zenity, yad, ssh-askpass in order |
| [scripts/install.sh](./scripts/install.sh) | Installer - copies binaries, creates sudoers entry with !tty_tickets |
| [scripts/uninstall.sh](./scripts/uninstall.sh) | Uninstaller - removes all installed files |

## Common Issues (AI Quick Reference)

### Password prompt on every sudo command
**Cause:** `tty_tickets` enabled (default sudo behavior)
**Fix:** Add `!tty_tickets` to sudoers:
```
Defaults:username timestamp_timeout=90, !tty_tickets
```

### Credentials expire mid-session
**Behavior:** With SUDO_ASKPASS set, next sudo triggers GUI prompt automatically
**No restart needed:** Just re-authenticate when prompted

### No GUI dialog
**Requirement:** kdialog, zenity, yad, or ssh-askpass must be installed
**Install:** `sudo dnf install kdialog` or `sudo apt install zenity`

## How It Works (Summary)

1. `claude-sudo` exports `SUDO_ASKPASS=/usr/local/bin/claude-askpass`
2. Calls `sudo -A -v` to authenticate (triggers GUI dialog)
3. Spawns background keepalive process (refreshes every 4 min)
4. Execs `claude` with all arguments
5. On exit, trap kills keepalive process

## Installed Files

| Destination | Source |
|-------------|--------|
| `/usr/local/bin/claude-sudo` | `bin/claude-sudo` |
| `/usr/local/bin/claude-askpass` | `bin/claude-askpass` |
| `/etc/sudoers.d/claude-sudo` | Generated by installer |

## Security Model

- **No passwords stored** - Uses sudo timestamp files only
- **No NOPASSWD** - Requires authentication each session
- **Audit trail** - All sudo usage logged to `/var/log/auth.log`
- **Session-scoped** - 90-minute timeout (configurable)
